{
  "name": "Multi-model consensus demo (with Scope Gate)",
  "steps": [
    {
      "id": "fanout_1",
      "op": "fanout_generate",
      "prompt": "Summarize: The battery lasts all day but the UI is confusing for first-time users.",
      "models": ["echo", "upper", "reverse"],
      "params": { "seed": 123 }
    },
    {
      "id": "consensus_1",
      "op": "consensus_vote",
      "inputs_from": "fanout_1"
    },

    // ---- Scope Gate: machine-check that produces scope/summary.json ----
    {
      "id": "scope_check",
      "op": "assert_contains",
      "args": {
        "from_step": "consensus_1",
        "field": "consensus_text",
        "must_include": [
          "battery lasts all day",
          "ui is confusing"
        ],
        "emit_scope": true          // <= tells the runner to write scope/summary.json
      }
    },

    {
      "id": "gate_review",
      "op": "audit_gate",
      "args": { "checklist": "templates/audit-checklist.md" }
    },

    // ---- Artifacts for humans ----
    {
      "id": "emit_fanout",
      "op": "write_text",
      "args": { "path": "notes/fanout.txt", "from_step": "fanout_1" }
    },
    {
      "id": "emit_consensus",
      "op": "write_text",
      "args": { "path": "notes/consensus.txt", "from_step": "consensus_1", "field": "consensus_text" }
    }
  ]
}
